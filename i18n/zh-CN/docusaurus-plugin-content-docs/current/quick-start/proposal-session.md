---
title: 使用提案会话将主意转化为代码
description: 了解如何使用提案会话（主意会话）通过 OpenSpec 的结构化工作流程将抽象想法转化为可执行代码。
sidebar_position: 40
---

# 使用提案会话将主意转化为代码

本指南将向您展示如何在 PCode 中使用提案会话（也称为主意会话）。提案会话提供一个结构化的工作流程，通过 OpenSpec 的提案生命周期系统将您的想法转化为执行的变更。

## 先决条件

在使用提案会话之前，请确保您已经：

- 安装并运行了 PCode（参见[安装指南](/docs/quick-start/installation)）
- 创建了项目并初始化了 OpenSpec（参见[创建您的第一个项目](/docs/quick-start/create-first-project)）
- 基本了解普通会话（参见[创建普通会话](/docs/quick-start/conversation-session)）

## 什么是提案会话？

提案会话是一个结构化的工作流程，指导您完成将抽象想法转化为执行代码的过程。与普通会话的自由聊天不同，提案会话遵循定义的 9 阶段生命周期：

- **阶段 0**：初始化 - 定义您的想法
- **阶段 1**：优化中 - AI 完善您的描述
- **阶段 2**：草稿 - 审查和手动编辑
- **阶段 3**：生成中 - AI 创建详细计划
- **阶段 4**：审查 - 注释和批准变更
- **阶段 5**：执行中 - AI 实施变更
- **阶段 6**：执行完成 - 在 IDE 中验证
- **阶段 7**：归档中 - 最终确定提案
- **阶段 8**：已归档 - 生命周期完成

```
┌────────────────────────────────────────────────────────────────────┐
│                    提案会话生命周期                                 │
├────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────┐    ┌───────────┐    ┌─────────┐    ┌───────────┐    │
│  │ 阶段 0  │───▶│ 阶段 1    │───▶│ 阶段 2  │───▶│ 阶段 3    │    │
│  │  新想法  │    │ 优化中    │    │  草稿   │    │ 生成中    │    │
│  │         │    │  (AI)     │    │(手动)   │    │  (AI)    │    │
│  └─────────┘    └───────────┘    └─────────┘    └───────────┘    │
│       │                                                                 │
│       ▼                                                                 │
│  ┌─────────┐    ┌───────────┐    ┌─────────┐    ┌───────────┐    │
│  │ 阶段 8  │◀───│ 阶段 7    │◀───│ 阶段 6  │◀───│ 阶段 4    │    │
│  │ 已归档  │    │ 归档中    │    │执行完成 │    │  审查     │    │
│  │         │    │  (AI)     │    │         │    │ (手动)    │    │
│  └─────────┘    └───────────┘    └─────────┘    └─────┬─────┘    │
│                                                         │          │
│                                                         ▼          │
│                                                    ┌───────────┐  │
│                                                    │  阶段 5   │  │
│                                                    │  执行中   │  │
│                                                    │   (AI)    │  │
│                                                    └───────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────────┘
```

## 阶段 0：初始化

第一步是创建一个新想法并提供初始描述。

### 创建新想法

1. 在会话列表面板中，点击 **+ New Idea**（新想法）按钮
2. 输入提案的标题
3. 描述您想要完成的内容

```
┌─────────────────────────────────────────────────────────────┐
│  新想法                                                      │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  标题：[添加用户身份验证系统]                                 │
│                                                              │
│  描述：                                                      │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 我想为我的应用添加基于 JWT 的身份验证。               │
│  │ 用户应该能够注册、登录和注销。                         │
│  │ 密码应使用 bcrypt 进行哈希处理。                      │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  [取消]                                  [创建提案]          │
└─────────────────────────────────────────────────────────────┘
```

### 良好初始描述的技巧

- **明确目标**：您要解决什么问题？
- **提及关键要求**：是否有特定技术或约束？
- **保持高层次**：细节将在后续阶段添加

## 阶段 1：优化中（AI 自动）

提交想法后，AI 会自动处理和完善它。

### 优化期间发生的事情

AI 分析您的描述并：
- **澄清模糊的需求**
- **建议适当的技术**
- **识别潜在的边缘情况**
- **生成提案名称**

### 无需用户操作

此阶段完全自动化。您将看到加载指示器，同时 AI 正在工作：

```
┌─────────────────────────────────────────────────────────────┐
│  优化中...                                                  │
│  AI 正在完善您的描述                                        │
│  ●●●●○○○○○○                                                 │
└─────────────────────────────────────────────────────────────┘
```

### 结果：优化的草稿

完成后，您将看到优化版本，其中包含：
- 生成的提案名称
- 包含附加细节的完善描述
- 识别的范围和边界

## 阶段 2：草稿（用户手动）

现在您有机会在开始规划之前审查和编辑提案。

### 审查优化的内容

优化的草稿供您审查：

```
┌─────────────────────────────────────────────────────────────┐
│  提案：添加 JWT 身份验证系统                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  描述：                                                      │
│  [AI 优化的描述文本...]                                     │
│                                                              │
│  [编辑]  [重新生成]  [批准并继续]                            │
└─────────────────────────────────────────────────────────────┘
```

### 您的选项

1. **编辑**：手动修改描述
2. **重新生成**：要求 AI 使用不同参数重新优化
3. **批准并继续**：接受草稿并进入规划阶段

### 进行手动编辑

点击 **编辑** 修改提案：

```markdown
# 添加 JWT 身份验证系统

## 概述
实现基于 JWT 的身份验证，包含安全的密码处理。

## 要求
- 带有电子邮件验证的用户注册
- 登录/注销功能
- 使用 bcrypt 进行密码哈希
- JWT 令牌生成和验证
- 刷新令牌机制

## 技术栈
- JWT 用于令牌管理
- bcrypt 用于密码哈希
- 标准身份验证中间件
```

## 阶段 3：生成中（AI 自动）

批准草稿后，AI 会自动生成详细的实施计划。

### 点击"生成计划"

点击 **Generate Plan** 按钮触发自动规划：

```
┌─────────────────────────────────────────────────────────────┐
│  正在生成计划...                                            │
│  AI 正在创建详细的实施文档                                  │
│  ●●●●●●●●○○                                                 │
└─────────────────────────────────────────────────────────────┘
```

### 生成的文档类型

AI 创建多个文档：

| 文档 | 用途 |
|------|------|
| **计划** | 分步实施指南 |
| **规范** | 技术规范和架构 |
| **变更** | 要创建/修改的文件列表 |
| **测试** | 测试用例和验证策略 |

### 审查生成的文档

生成完成后，您可以审查所有文档：

```
┌─────────────────────────────────────────────────────────────┐
│  生成的文档                                                 │
├─────────────────────────────────────────────────────────────┤
│  📄 计划          - 实施步骤                                │
│  📄 规范          - 技术规范                                │
│  📄 变更          - 要修改的文件                            │
│  📄 测试          - 测试策略                                │
│                                                              │
│                    [审查和注释]                              │
└─────────────────────────────────────────────────────────────┘
```

## 阶段 4：审查（用户手动）

这是最关键的阶段，您在此审查、注释和批准实施计划。

### 三层注释系统

PCode 提供三个级别的注释来提供反馈：

```
┌─────────────────────────────────────────────────────────────┐
│  注释级别                                                   │
├─────────────────────────────────────────────────────────────┤
│  1. 行内注释   - 特定行反馈                                 │
│  2. 文件注释     - 整个文档反馈                             │
│  3. 全局注释   - 整体提案反馈                             │
└─────────────────────────────────────────────────────────────┘
```

### 1. 行内注释

突出显示特定文本并添加评论：

```
┌─────────────────────────────────────────────────────────────┐
│  实施计划                                                   │
├─────────────────────────────────────────────────────────────┤
│  1. 创建 AuthService 类                                     │
│     [TODO: 确保这遵循现有模式]                    ◀──行内
│                                                              │
│  2. 添加 JWT 中间件                    ◀──[使用现有中间件]    │
│                                                              │
│  3. 创建身份验证端点                     ◀──[添加速率限制]   │
└─────────────────────────────────────────────────────────────┘
```

### 2. 文件注释

在文档级别添加反馈：

```
┌─────────────────────────────────────────────────────────────┐
│  📝 文件注释：Plan.md                                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 整体计划看起来不错，但请：                           │   │
│  │ - 考虑使用我们现有的 BaseRepository 模式             │   │
│  │ - 为重复电子邮件添加错误处理                         │   │
│  │ - 在关键步骤添加日志记录                             │   │
│  └──────────────────────────────────────────────────────┘   │
│  [保存]                                                     │
└─────────────────────────────────────────────────────────────┘
```

### 3. 全局注释

为提案提供整体反馈：

```
┌─────────────────────────────────────────────────────────────┐
│  🌐 全局注释                                                │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 整个提案的一般反馈：                                 │   │
│  │                                                      │   │
│  │ 范围对于第一次迭代似乎是合适的。                     │   │
│  │ 让我们先专注于基本身份验证，社交登录可以             │   │
│  │ 稍后作为单独的提案。                                 │   │
│  └──────────────────────────────────────────────────────┘   │
│  [保存]                                                     │
└─────────────────────────────────────────────────────────────┘
```

### 提交循环

注释以循环方式工作：

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  注释       │────▶│   提交      │────▶│   AI        │
│  (您)       │     │  反馈       │     │  调整       │
└─────────────┘     └─────────────┘     └──────┬──────┘
                                             │
                                             ▼
                                      ┌─────────────┐
                                      │  审查       │
                                      │  更新后的   │
                                      │  计划       │
                                      └──────┬──────┘
                                             │
                                    满意吗？ │ 否
                                             │
                                    ┌────────┴────────┐
                                    │                 │
                                   是               否
                                    │                 │
                                    ▼                 ▼
                              ┌─────────┐    ┌─────────────┐
                              │ 立即    │    │ 再次注释     │
                              │ 执行    │    │             │
                              └─────────┘    └─────────────┘
```

### 批准执行

对计划满意后：
1. 确保所有关键反馈都已处理
2. 点击 **批准并执行**
3. 提案进入执行阶段

## 阶段 5：执行中（AI 自动）

AI 现在自动实施批准的计划。

### 点击"立即执行"

点击 **Execute Now** 按钮开始实施：

```
┌─────────────────────────────────────────────────────────────┐
│  正在执行...                                                │
│  AI 正在实施批准的计划                                      │
│  ●●●●●●●●●○                                                 │
│                                                              │
│  正在创建 AuthService...                                    │
│  正在添加 JWT 中间件...                                     │
│  正在创建身份验证端点...                                    │
└─────────────────────────────────────────────────────────────┘
```

### 执行期间发生的事情

AI：
- 按照规范创建新文件
- 修改现有文件以进行变更
- 逐步遵循实施计划
- 显示每个操作的进度

### 执行完成

执行完成后，您将看到：
- 创建/修改的文件摘要
- 遇到的任何警告或问题
- 查看变更的链接

## 阶段 6：执行完成

AI 已完成实施。现在是时候验证变更了。

### 在 IDE 中审查

在您首选的 IDE 中打开项目进行审查：

```
┌─────────────────────────────────────────────────────────────┐
│  执行完成！                                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  创建的文件：                                               │
│  ✓ src/services/AuthService.ts                             │
│  ✓ src/middleware/jwtAuth.ts                               │
│  ✓ src/controllers/AuthController.ts                       │
│                                                              │
│  修改的文件：                                               │
│  ✓ src/index.ts（添加中间件）                              │
│  ✓ src/routes/index.ts（添加身份验证路由）                 │
│                                                              │
│  [在 IDE 中打开]  [继续归档]                                │
└─────────────────────────────────────────────────────────────┘
```

### 编辑模式对话

阶段 6 启用特殊的对话模式用于执行后调整：

```
┌─────────────────────────────────────────────────────────────┐
│  执行完成 - 已启用编辑模式                                  │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ AI: 我已实现 JWT 身份验证系统。                      │   │
│  │ 您希望我进行任何调整吗？                              │   │
│  │                                                      │   │
│  │ 您: 能否为登录端点添加速率限制？                      │   │
│  │                                                      │   │
│  │ AI: 我将为登录端点添加速率限制。                      │   │
│  │ [应用变更]                                           │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  [满意 - 继续归档]                                          │
└─────────────────────────────────────────────────────────────┘
```

### 验证清单

继续之前：
- [ ] 在 IDE 中审查所有文件变更
- [ ] 在本地测试新功能
- [ ] 运行任何现有测试
- [ ] 通过编辑模式请求任何最终调整
- [ ] 确保符合代码质量标准

## 阶段 7：归档中（AI 自动）

对实施满意后，AI 会归档提案。

### 点击"归档计划"

点击 **Archive Plan** 按钮完成：

```
┌─────────────────────────────────────────────────────────────┐
│  正在归档...                                                │
│  AI 正在最终确定提案                                        │
│  ●●●●●●●●●●                                                 │
└─────────────────────────────────────────────────────────────┘
```

### 归档期间发生的事情

AI：
- 将提案标记为完成
- 创建变更摘要
- 生成提交消息建议
- 将提案移动到归档

:::note 无代码提交
归档不会自动将代码提交到您的存储库。您应该审查变更并使用 git 手动提交。
:::

## 阶段 8：已归档

提案生命周期已完成。提案现在在归档中。

### 查看已归档的提案

```
┌─────────────────────────────────────────────────────────────┐
│  ✅ 提案已归档                                             │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  标题：添加 JWT 身份验证系统                                 │
│  状态：已完成                                               │
│  日期：2025-01-12                                           │
│                                                              │
│  摘要：                                                      │
│  实现了基于 JWT 的身份验证，使用 bcrypt 密码                │
│  哈希。添加了 AuthService、JWT 中间件和身份验证              │
│  端点。                                                      │
│                                                              │
│  变更文件：5                                                │
│  新增行数：342                                              │
│                                                              │
│  [查看完整详情]  [创建新提案]                                │
└─────────────────────────────────────────────────────────────┘
```

### 提交您的变更

记得提交实施的变更：

```bash
cd /path/to/your/project
git add .
git commit -m "添加 JWT 身份验证系统

- 实现带有 JWT 令牌生成的 AuthService
- 添加用于路由保护的 JWT 中间件
- 创建身份验证端点（注册、登录、注销）
- 集成 bcrypt 进行密码哈希"
```

## 状态参考

| 阶段 | 名称 | 类型 | 描述 |
|------|------|------|------|
| 0 | 初始化 | 用户 | 创建带有标题和描述的新想法 |
| 1 | 优化中 | AI | AI 完善描述并生成名称 |
| 2 | 草稿 | 用户 | 审查并手动编辑提案 |
| 3 | 生成中 | AI | AI 创建详细的实施计划 |
| 4 | 审查 | 用户 | 注释计划并批准执行 |
| 5 | 执行中 | AI | AI 实施批准的变更 |
| 6 | 执行完成 | 用户 | 验证变更并进行调整 |
| 7 | 归档中 | AI | AI 完成并归档提案 |
| 8 | 已归档 | - | 提案生命周期完成 |

## 何时使用提案会话

### 对以下情况使用提案会话：

- **主要功能**：添加重要的新功能
- **重构**：大规模代码重组
- **架构变更**：修改系统设计模式
- **多文件变更**：影响许多文件的变更
- **复杂实施**：需要仔细规划的任务

### 对以下情况使用普通会话：

- **问题**：关于代码的快速答案
- **小变更**：单文件修改
- **探索**：理解现有代码
- **规划**：在实施前讨论方法
- **代码审查**：获得特定代码的反馈

```
┌─────────────────────────────────────────────────────────────┐
│  选择正确的会话类型                                         │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  普通会话                      提案会话                      │
│  ┌─────────────────┐           ┌─────────────────┐         │
│  │ • 快速问题      │           │ • 主要功能      │         │
│  │ • 代码分析      │           │ • 重构          │         │
│  │ • 小编辑        │           │ • 架构          │         │
│  │ • 探索          │           │ • 多文件        │         │
│  │                 │           │   变更          │         │
│  │ [快速且灵活]    │           │ [结构化]        │         │
│  └─────────────────┘           └─────────────────┘         │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## 有效提案会话的技巧

### 1. 从清晰的愿景开始

在创建提案之前，清楚地了解：
- 您要解决的问题
- 预期结果
- 任何约束或要求

```
好："使用 JWT 添加用于安全 API 访问的用户身份验证"
模糊："添加身份验证相关的东西"
```

### 2. 明智地使用草稿阶段

阶段 2（草稿）是您的最佳机会：
- 澄清需求
- 调整范围
- 为 AI 设定期望

### 3. 在注释中详尽无遗

在阶段 4（审查）中，详细的注释会产生更好的结果：
- **行内**：具体实施细节
- **文件**：文档级反馈
- **全局**：总体方向和约束

### 4. 执行后测试

始终在阶段 6 验证实施：
- 运行应用程序
- 测试新功能
- 检查回归
- 使用编辑模式进行调整

### 5. 记录决策

使用注释记录为什么选择某些方法：
- "出于安全考虑使用 bcrypt 而不是 MD5"
- "将社交登录推迟到未来的提案"
- "重用现有的 BaseRepository 模式"

### 6. 如有必要进行迭代

如果第一次尝试不完美：
- 在阶段 6 使用编辑模式进行调整
- 为附加功能创建后续提案
- 从每个提案中学习以改进未来的提案

## 后续步骤

现在您了解了提案会话，请继续探索：

- **[创建您的第一个项目](/docs/quick-start/create-first-project)**：设置您的第一个项目
- **[对话会话](/docs/quick-start/conversation-session)**：了解 AI 驱动的对话功能

## 总结

在本指南中，您了解到：

1. 什么是提案会话以及何时使用它们
2. 完整的 9 阶段提案生命周期
3. AI 自动阶段（1、3、5、7）如何工作
4. 如何使用用户手动阶段（0、2、4、6）
5. 三层注释系统
6. 何时选择提案会话与普通会话

您现在已准备好使用 PCode 的结构化提案工作流程将您的想法转化为执行的代码！
